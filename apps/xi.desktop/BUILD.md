# Инструкция по сборке и установке Xi Desktop

## Архитектура

`xi.desktop` является Electron-обёрткой вокруг веб-приложения `xi.web`. В режиме разработки используется Vite dev server от `xi.web` с поддержкой HMR (Hot Module Replacement).

## Предварительные требования

1. Убедитесь, что у вас установлен Node.js (рекомендуется версия 18+)
2. Установите зависимости проекта (из корня монорепо):
   ```bash
   pnpm install
   ```

## Разработка (Development)

Для запуска приложения в режиме разработки:

```bash
cd apps/xi.desktop
pnpm dev
```

Это запустит:

- Vite dev server от `xi.web` на порту **5173**
- Electron приложение, подключенное к dev server
- **HMR работает автоматически** через WebSocket от Vite

### Настройка портов

**Порты по умолчанию:**

- `xi.web`: порт `5173` (настраивается в `apps/xi.web/vite.config.ts`)
- `xi.desktop`: подключается к порту `5173` (можно переопределить через `WEB_APP_PORT`)

**Изменение порта:**

1. Для `xi.web` - измените `server.port` в `apps/xi.web/vite.config.ts`
2. Для `xi.desktop` - используйте переменную окружения:
   ```bash
   WEB_APP_PORT=5174 pnpm dev
   ```

**Важно:** Если вы изменили порт `xi.web`, убедитесь, что `xi.desktop` подключается к правильному порту!

## Сборка приложения

### 1. Сборка для macOS

```bash
cd apps/xi.desktop
pnpm build
```

После сборки вы найдете установочные файлы в папке `release/`:

- `Xi Desktop-1.0.0.dmg` - установщик для macOS
- `Xi Desktop-1.0.0-mac.zip` - архив с приложением

### 2. Установка на macOS

**Вариант 1: Через DMG файл**

1. Откройте `Xi Desktop-1.0.0.dmg`
2. Перетащите приложение в папку Applications
3. Запустите приложение из Applications

**Вариант 2: Через ZIP архив**

1. Распакуйте `Xi Desktop-1.0.0-mac.zip`
2. Переместите приложение в папку Applications
3. При первом запуске macOS может показать предупреждение о безопасности
4. Перейдите в Настройки → Безопасность и разрешите запуск приложения

### 3. Сборка для других платформ

**Windows:**

```bash
pnpm build
```

Создаст `Xi Desktop-1.0.0.exe` (portable версия)

**Linux:**

```bash
pnpm build
```

Создаст `Xi Desktop-1.0.0.AppImage` и `Xi Desktop-1.0.0.deb`

## Структура сборки

Процесс сборки включает:

1. Сборка веб-приложения `xi.web` → `apps/xi.web/build/`
2. Компиляция TypeScript main процесса Electron → `dist/main/`
3. Создание установочных файлов через electron-builder → `release/`
   - Веб-приложение копируется в `resources/xi.web/build/`

## Устранение проблем

### Ошибка при сборке

- Убедитесь, что все зависимости установлены: `pnpm install`
- Проверьте, что TypeScript компилируется без ошибок: `pnpm run build:main`

### Приложение не запускается после установки

- На macOS: проверьте настройки безопасности в Системных настройках
- Убедитесь, что все файлы собраны корректно в папке `dist/`

### Проблемы с путями

- Убедитесь, что структура папок соответствует ожидаемой
- Проверьте, что `dist/main/index.js` существует
- Проверьте, что `apps/xi.web/build/index.html` существует (после сборки)

### HMR не работает

- Убедитесь, что `xi.web` dev server запущен на порту 5173
- Проверьте, что в Electron окне открыты DevTools (для отладки)
- HMR работает автоматически через WebSocket от Vite, дополнительная настройка не требуется
